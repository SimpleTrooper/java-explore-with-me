# Explore with me.
Сервис, позволяющий людям организовывать ивенты. Можно добавлять, отменять, редактировать события пользователям, 
подтверждать и отклонять заявки на участие, указывать для события определенные координаты, по которым затем можно 
связать событие с локацией. Для администратора предусмотрена возможность редактирования событий пользователей, модерации 
событий. Также администратор может управлять учетными записями пользователей, категориями событий и локациями. Реализована 
возможность управления подборками событий, закрепления и открепления их на главной странице. Для локаций реализовано обратное 
геокодирование (определение адреса по координатам) через сервис graphhopper.com. 

# Сборка и запуск
Для сборки приложения следует использовать сборщик Maven, команду:

__mvn package -Dmaven.test.skip__

Для развертывания используется Docker:

__docker-compose up__

# Архитектура 
Приложение разбито на 3 микросервиса. Основной сервис - explore-with-me-main, сервис для сбора статистики по посещениям - 
explore-stat и сервис геокодирования - explore-geocoding. Считается, что все запросы приходят от авторизованных 
пользователей (за авторизацию отвечает сторонний микросервис). Для тел запросов и ответов используется формат JSON. В качестве
СУБД выбрана PostgreSQL 14.

# REST-API
Функционал приложения реализован в виде REST-API. API поделено на 3 части: 
- Публичная часть, позволяющая просматривать события, категории и подборки событий. Доступно для всех пользователей
- Закрытая часть, реализующая функционал взаимодействия пользователей с приложением. Позволяет добавлять, редактировать, 
просматривать, отменять свои события. Подтверждать запросы на участия в своих событиях, оставлять запросы на участие в чужих событиях 
- Часть администратора. Доступно для авторизованных администраторов. Позволяет просматривать, редактировать, публиковать и отклонять события. 
Управлять категориями, пользователями и локациями. Редактировать, закреплять и откреплять подборки событий на главной странице
 
Статистика собирается с публичных эндпоинтов для событий - GET /events и GET /events/{id}.
Полную спецификацию по эндпоинтам, кроме эндпоинтов фичи с локациями, можно посмотреть в файлах - [Основной сервис](ewm-main-service-spec.json)
и [Сервис статистики](ewm-stats-service-spec.json). 

# Фича - добавление локаций администратором и поиск событий в локации.

Локация - круг на карте с координатами (широта, долгота) и радиусом в километрах. Каждое событие содержит координаты. 
Считается, что событие происходит в определенной локации, если координаты этого события лежат внутри заданного круга.
Локация имеет тип - COUNTRY (Страна), STATE (Регион), CITY (Город), ADDRESS (Адрес) и PLACE (Неопределенное место).
Локации добавляются администратором и при добавлении происходит запрос на удаленное api https://graphhopper.com/api/1
для получения сведений о месте на карте по его координатам (обратное геокодирование).

__Добавлены эндпоинты основному сервису:__

__Часть администратора -__

__GET /admin/locations?locationIds={Список id локаций}&from={от}&size={размер}__ - получение всех локаций
Ответ - список AdminLocationDto.

__POST /admin/locations__ - добавление новой локации. Тело - NewLocationDto,
ответ - AdminLocationDto

__PATCH /admin/locations__ - обновление информации о локации. Тело - NewLocationDto,
ответ - AdminLocationDto

__DELETE /admin/locations/{id}__ - удаление локации по id

__PATCH /admin/locations/{id}/resolve__ - обновить информацию о локации с сервиса геокодирования
ответ - AdminLocationDto

__GET /admin/events?location={locationId}__ - поиск всех событий в указанной локации. 
Ответ - список AdminEventFullDto

AdminEventFullDto -

    {
        "annotation": "Аннотация",
        "category": {
                    "id": id,
                    "name": "Название категории"  
                    },
        "confirmedRequests": "Количество подтвержденных участников",
        "createdOn": "Дата создания", 
        "description": "Описание",
        "eventDate": "Дата события",  
        "id": id,
        "initiator": {
                    "id": id,
                    "name": "Имя пользователя"  
                    },
        "location": {
                    "lat": Долгота, 
                    "lon": Широта
                    },
        "paid": Платное либо бесплатное,
        "participantLimit": Максимальное число участников, 
        "publishedOn": Дата публикации администратором,
        "requestModeration": Нужно ли подтверждение запросов на участие в событии,
        "state": "Статус события"
        "title": "Название",
        "views": "Количество просмотров"
    }

AdminLocationDto -

    {
        "id": id,
        "name": "Название",
        "description": "Описание",
        "lat": Широта,  
        "lon": Долгота,
        "radius": Радиус в км,
        "country": "Страна",
        "state": "Регион",
        "city": "Город",
        "postalCode": "Почтовый индекс",
        "street": "Улица",
        "housenumber": "Номер дома",
        "type": "Тип локации",
        "resolved": Получена ли информация с сервиса геокодирования - boolean,
        "resolveDate": Дата последнего обновления информации с сервиса геокодирования
    }

NewLocationDto -

    {
        "id": id,
        "name": "Название",
        "description": "Описание",
        "lat": Широта,  
        "lon": Долгота,
        "radius": Радиус в км,
        "type": "Тип локации"
    }

__Публичная часть -__

__GET /locations?from={от}&size={размер}__ - получить все локации. Ответ - список PublicLocationDto

__GET /locations/{locationId}__ - получить локацию по id.
Ответ - PublicLocationDto

__GET /events?location={locationId}__ - поиск всех событий в указанной локации. 
Ответ - список PublicEventShortDto

PublicLocationDto -

    {
        "id": id,
        "name": "Название",
        "description": "Описание",
        "lat": Широта,  
        "lon": Долгота,
        "radius": Радиус в км,
        "country": "Страна",
        "state": "Регион",
        "city": "Город",
        "postalCode": "Почтовый индекс",
        "street": "Улица",
        "housenumber": "Номер дома",
        "type": "Тип локации",
        "resolved": Получена ли информация с сервиса геокодирования - boolean,
        "resolveDate": Дата последнего обновления информации с сервиса геокодирования
    }

PublicEventShortDto -

    {
        "annotation": "Аннотация",
        "category": {
                        "id": id,
                        "name": "Название категории"  
                    },
        "confirmedRequests": "Количество подтвержденных участников",
        "eventDate": "Дата события",  
        "id": id,
        "initiator": {
                         "id": id,
                         "name": "Имя пользователя"  
                     },
        "paid": Платное либо бесплатное,
        "title": "Название",
        "views": "Количество просмотров"
    }

Добавлен сервис геокодирования. Его эндпоинты: 

__GET /geocode?lat={широта}&lon={долгота}&type={тип локации} - получить информацию о локации по координатам. 
Ответ - OutputLocationDto

OutputLocationDto -

    {
        "country": "Страна",
        "state": "Регион",
        "city": "Город",
        "postalCode": "Почтовый индекс",
        "street": "Улица",
        "housenumber": "Номер дома",
        "type": "Тип локации",
        "resolved": Получена ли информация с сервиса геокодирования - boolean,
        "resolveDate": Дата последнего обновления информации с сервиса геокодирования
    }

# Postman
Для тестирования эндпоинтов используется Postman. Тесты лежат в папке [./postman-test](./postman-test). Тестирование фичи
локаций требует чистой (!) БД.
# ER-Диаграммы

![ER-Диаграмма основной БД](/png/ExploreER.png)
![ER-Диаграмма БД статистики](/png/StatisticsER.png)
